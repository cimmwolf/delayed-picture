<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="delayed-element.html">

<dom-module id="delayed-picture">
    <template>
        <style>
            :host {
                /* workaround for Edge intersectionObserverApi bug*/
                display: inline-block;
                min-width: 1px;
            }
        </style>
        <slot></slot>
        <picture id="picture">
            <img id="img" src alt>
        </picture>
    </template>
    <script>
        class DelayedPicture extends DelayedElement {
            static get is() {
                return 'delayed-picture'
            }

            static get properties() {
                return {
                    alt: {type: String, value: ''}
                }
            }

            load() {
                let sources = this.querySelectorAll('source');
                for (let i = 0, len = sources.length; i < len; i++) {
                    let source = sources[i];
                    if (!source.getAttribute('srcset')) {
                        source.setAttribute('srcset', source.getAttribute('src'));
                    }
                    source.removeAttribute('src');
                    this.$.picture.insertBefore(source, this.$.img);
                }

                this.$.img.setAttribute('alt', this.alt);
                this.$.picture.className = this.className;
                this.className = '';
            }
        }

        customElements.define(DelayedPicture.is, DelayedPicture);
    </script>
</dom-module>
